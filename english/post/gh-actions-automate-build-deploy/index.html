<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>Using Github Actions to Automate Build and Deploy. - The mind of Brennan</title><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=referrer content="no-referrer"><meta name=description content><meta property="og:site_name" content="The mind of Brennan"><meta property="og:locale" content="en_US"><meta property="og:type" content="article"><meta property="og:url" content="https://blog.brennan.sh/english/post/gh-actions-automate-build-deploy/"><meta property="og:title" content="Using Github Actions to Automate Build and Deploy."><meta property="og:image" content="https://blog.brennan.sh/img/gh-action-build-deploy/tabs.PNG"><meta property="og:description" content><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="Using Github Actions to Automate Build and Deploy."><meta name=twitter:description content><meta name=twitter:image content="https://blog.brennan.sh/img/gh-action-build-deploy/tabs.PNG"><link rel=canonical href=https://blog.brennan.sh/english/post/gh-actions-automate-build-deploy/><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.2/css/bootstrap.min.css integrity="sha512-MoRNloxbStBcD8z3M/2BmnT+rg4IsMxPkXaGh2zD6LGNNFE80W3onsAhRcMAMrSoyWL9xD7Ert0men7vR8LUZg==" crossorigin=anonymous><link rel=stylesheet href=https://blog.brennan.sh/css/custom.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/github-gist.min.css integrity="sha512-od7JLoOTxM8w/HSKGzP9Kexc20K9p/M2zxSWsd7H1e4Ctf+8SQFtCWEZnW5u6ul5ehSECa5QmOk9ju2nQMmlVA==" crossorigin=anonymous><link rel="shortcut icon" href=https://blog.brennan.sh/favicon.png><link href=https://blog.brennan.sh/index.xml rel=alternate type=application/rss+xml title="The mind of Brennan"></head><body><div class="mt-xl header"><div class=container><div class="row justify-content-center"><div class=col-auto><a href=https://blog.brennan.sh/><h1 class=name>The Mind of Brennan</h1></a></div></div><div class="row justify-content-center"><ul class="nav nav-primary"><li class=nav-item><a class=nav-link href=https://blog.brennan.sh/>Home</a></li><li class=nav-item><a class=nav-link href=https://blog.brennan.sh/about/>About</a></li><li class=nav-item><a class=nav-link href=https://github.com/brennanmcdonald>GitHub</a></li><li class=nav-item><a class=nav-link href=https://twitter.com/bmickeydonald>Twitter</a></li><li class=nav-item><a class=nav-link href=https://twitter.com/brennan-mcdonald>Linkedin</a></li></ul></div></div></div><div class=content><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-lg-8"><h1 class="mx-0 mx-md-4">Using Github Actions to Automate Build and Deploy.</h1><div class=markdown><ul><li><a href=#introduction>Introduction</a></li><li><a href=#elements-of-a-github-actions-workflow>Elements of a Github actions workflow</a><ul><li><a href=#trigger>Trigger</a></li><li><a href=#runner>Runner</a></li><li><a href=#actions>Actions</a><ul><li><a href=#checkout-action>Checkout Action</a></li><li><a href=#third-party-actions>Third Party Actions</a></li><li><a href=#custom-actions-run>Custom Actions (Run)</a></li></ul></li></ul></li></ul><h2 id=introduction>Introduction</h2><p>Github Actions are a relatively new feature that was put in place to help people run CI/CD workflows directly from Github Repos. In my opinion, if you host your code on Github, they are the cleanest and fastest free form of CI/CD out there today. To access the actions for a Github repo, navigate to the repo&rsquo;s page and click on the &ldquo;Actions&rdquo; tab at the top.</p><p><img src=https://blog.brennan.sh/img/gh-action-build-deploy/tabs.PNG alt=tabs></p><p>Here you can check the status of existing workflows, and by clicking the new workflow button you can deploy an existing template or a blank workflow file.</p><p><img src=https://blog.brennan.sh/img/gh-action-build-deploy/new_workflow.PNG alt="Sections of a workflow"></p><h2 id=elements-of-a-github-actions-workflow>Elements of a Github actions workflow</h2><p>Github actions are <code>yaml</code> files that live in the <code>.github/workflows</code> folder. Here we have an overview of the actions involved in a workflow and the layout that they occur in.</p><p><img src=https://blog.brennan.sh/img/gh-action-build-deploy/sections.png alt="Sections of a workflow"></p><p>The core of a Github action workflow is a <code>yaml</code> file. There are hundreds of possible keys that exist to be used in this <code>YAML</code> file. However, today were only going to focus on the few important ones that are required for a basicly setup. We can start with the name for our workflow, it can be anything so don&rsquo;t worry about what you put here.</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>name: Build and Deploy
</code></pre></div><h3 id=trigger>Trigger</h3><p>The trigger is the action that tells your workflow to run. This can be anything from pushing to a branch, cron events, or even webhook events. More on actions can be found <a href=https://help.github.com/en/actions/reference/events-that-trigger-workflows>here</a>. For the sake of this guide, we will be using a <em><strong>push to branch</strong></em> action, in specific we will be triggering our event on a push to the master branch. This is done by using the following 4 lines of code.</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>on:
  push:
    branches:
      - master
</code></pre></div><p>This reads fairly cleanly so I wont explain it too much, but the root key is the <code>on:</code> key which says the following lines will define our trigger. We then have the <code>push:</code> key which says that the trigger will be an <em><strong>on push</strong></em> trigger. Finally we have the <code>branches:</code> key which lists the branches we want our trigger to listen on. This can be any list of branches. For example, if we want this action to be for a pre-deploy envionment we can trigger on pushes to development branches.</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>on:
  push:
    branches:
      - alpha
      - beta
      - staging
</code></pre></div><h3 id=runner>Runner</h3><p>The runner is the host OS that our workflow will be running on. Due to the fact that Github Actions use <a href=https://www.docker.com/resources/what-container>docker containers</a> under the covers, we have to specify what we want that container to run.</p><p>At the time of writing this post, there are four available runners. One for Windows, two for Ubuntu Linux, and one for macOS.</p><table><thead><tr><th>Virtual environment</th><th>YAML workflow label</th></tr></thead><tbody><tr><td>Windows Server 2019</td><td><code>windows-latest</code> or <code>windows-2019</code></td></tr><tr><td>Ubuntu 18.04</td><td><code>ubuntu-latest</code> or <code>ubuntu-18.04</code></td></tr><tr><td>Ubuntu 16.04</td><td><code>ubuntu-16.04</code></td></tr><tr><td>macOS Catalina 10.15</td><td><code>macos-latest</code> or <code>macos-10.15</code></td></tr></tbody></table><p>In this guide, we&rsquo;re going to use the <code>ubuntu-16.04</code> (however the process would be the same with any of the Ubuntu runners) image as it&rsquo;ll be the easiest to use for our build process.</p><h3 id=actions>Actions</h3><p>Actions are denoted by the <code>setps:</code> key, which is followed by a list of groups of keys as illustrated in the image at the top of this page. Actions are the bulk of a github actions workflow. They describe the actions that will be executed in the workflow, from checking out the code, to running the actual build process, to deploying. We&rsquo;re going to spend some time learning</p><h4 id=checkout-action>Checkout Action</h4><p>In a build-deploy setup, the checkout action is typically the first step that our workflow will do. The checkout action fetches the most recent version of the repo. This action is provided by github on the &lsquo;actions&rsquo; organization. It is important to note that there are two versions of the checkout action provided by github actions. The key difference is that v1 supports checking out submodules.</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>- uses: actions/checkout@v1
  with:
    submodules: <span style=color:#00f>true</span>
</code></pre></div><h4 id=third-party-actions>Third Party Actions</h4><p>Other actions can be importated from other people&rsquo;s github repositories. By using the <code>uses:</code> key, you can specify a repo that will be pulled, built, and run during a workflow. These actions can take arguments by using the <code>with:</code> key, which takes a list of key-value pairs similar to envionment variables. For example, deploying a built static page to github pages, we can use <code>JamesIves/github-pages-deploy-action@releases/v3</code> like below:</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>- name: Deploy
  uses: JamesIves/github-pages-deploy-action@releases/v3
  with:
    ACCESS_TOKEN: ${{ secrets.ACCESS_TOKEN }}
    BRANCH: gh-pages
    FOLDER: dist
</code></pre></div><p>We name the custom action &ldquo;Deploy&rdquo; and say we will be using the <code>JamesIves/github-pages-deploy-action@releases/v3</code> action. Then by passing 3 arguments of <code>BRANCH</code>, <code>FOLDER</code>, and <code>ACCESS_TOKEN</code>, we can specify the behaviour of the action.</p><h4 id=custom-actions-run>Custom Actions (Run)</h4><p>You can also specify custom bash commands using the <code>run:</code> key.</p><div class=highlight><pre style=background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>- run: npm install
- run: npm run build --if-present
</code></pre></div></div></div></div></div></div><section id=comments><div class="py-3 content"><div class=container><div class="row justify-content-center"><div class="col-sm-12 col-lg-8"><div class=comments><script src=https://utteranc.es/client.js repo issue-term=pathname label=comment theme=github-light crossorigin=anonymous async></script></div></div></div></div></div></section><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/r.min.js defer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/python.min.js defer></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/stan.min.js defer></script><script>window.addEventListener('load',function(){hljs.initHighlighting()},!0)</script><script src=https://blog.brennan.sh/js/math-code.js></script><script async src="//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>