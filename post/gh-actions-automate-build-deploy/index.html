<!doctype html><html dir=ltr lang=en data-theme><head><title>Brennan | Using Github Actions to Automate Build and Deploy.</title><meta charset=utf-8><meta name=generator content="Hugo 0.83.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=description content="The Mind of John"><link rel=stylesheet href=/css/main.min.f79a5de55310cc058fc81804d033ddb955937d778bd533d9ea05b1c798501013.css integrity="sha256-95pd5VMQzAWPyBgE0DPduVWTfXeL1TPZ6gWxx5hQEBM=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/markupHighlight.min.f798cbda9aaa38f89eb38be6414bd082cfd71a6780375cbf67b6d2fb2b96491e.css integrity="sha256-95jL2pqqOPies4vmQUvQgs/XGmeAN1y/Z7bS+yuWSR4=" crossorigin=anonymous type=text/css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin=anonymous><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=canonical href=/post/gh-actions-automate-build-deploy/><script type=text/javascript src=/js/anatole-header.min.0c05c0a90d28c968a1cad4fb31abd0b8e1264e788ccefed022ae1d3b6f627514.js integrity="sha256-DAXAqQ0oyWihytT7MavQuOEmTniMzv7QIq4dO29idRQ=" crossorigin=anonymous></script><script type=text/javascript src=/js/anatole-theme-switcher.min.7fd87181cdd7e8413aa64b6867bb32f3a8dc242e684fc7d5bbb9f600dbc2b6eb.js integrity="sha256-f9hxgc3X6EE6pktoZ7sy86jcJC5oT8fVu7n2ANvCtus=" crossorigin=anonymous></script><meta name=twitter:card content="summary"><meta name=twitter:title content="Using Github Actions to Automate Build and Deploy."><meta name=twitter:description content="Github Actions are a relativey new feature that was put in place to help people run CI/CD workflows directly from Github Repos. In my opinion, if you host your code on Github, they are the cleanest and fastest free form of CI/CD out there today."></head><body><div class="sidebar animated fadeInDown"><div class=logo-title><div class=title><img src=/ alt="profile picture"><h3 title><a href=/>The Mind of John</a></h3><div class=description><p>The Mind of John</p></div></div></div><ul class=social-links><li><a href=https://linkedin.com/in/brennan-mcdonald rel=me aria-label=Linkedin><i class="fab fa-linkedin fa-2x" aria-hidden=true></i></a></li><li><a href=https://github.com/brennanmcdonald rel=me aria-label=GitHub><i class="fab fa-github fa-2x" aria-hidden=true></i></a></li><li><a href=https://www.instagram.com/brennanmcd rel=me aria-label=instagram><i class="fab fa-instagram fa-2x" aria-hidden=true></i></a></li></ul><div class=footer><div class=by_farbox>&copy; Brennan 2021</div></div></div><div class=main><div class="page-top animated fadeInDown"><a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true></span><span aria-hidden=true></span><span aria-hidden=true></span></a><ul class=nav id=navMenu><li class=theme-switch-item><a class=theme-switch title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></li></ul></div><div class=autopagerize_page_element><div class=content><div class="post animated fadeInDown"><div class=post-content><div class=post-title><h3>Using Github Actions to Automate Build and Deploy.</h3><div class=info><em class="fas fa-calendar-day"></em><span class=date>15/2/2020</span>
<em class="fas fa-stopwatch"></em><span class=reading-time>4-minute read</span></div></div><ul><li><a href=#introduction>Introduction</a></li><li><a href=#elements-of-a-github-actions-workflow>Elements of a Github actions workflow</a><ul><li><a href=#trigger>Trigger</a></li><li><a href=#runner>Runner</a></li><li><a href=#actions>Actions</a><ul><li><a href=#checkout-action>Checkout Action</a></li><li><a href=#third-party-actions>Third Party Actions</a></li><li><a href=#custom-actions-run>Custom Actions (Run)</a></li></ul></li></ul></li></ul><h2 id=introduction>Introduction</h2><p>Github Actions are a relatively new feature that was put in place to help people run CI/CD workflows directly from Github Repos. In my opinion, if you host your code on Github, they are the cleanest and fastest free form of CI/CD out there today. To access the actions for a Github repo, navigate to the repo&rsquo;s page and click on the &ldquo;Actions&rdquo; tab at the top.</p><p><img src=/img/gh-action-build-deploy/tabs.PNG alt=tabs></p><p>Here you can check the status of existing workflows, and by clicking the new workflow button you can deploy an existing template or a blank workflow file.</p><p><img src=/img/gh-action-build-deploy/new_workflow.PNG alt="Sections of a workflow"></p><h2 id=elements-of-a-github-actions-workflow>Elements of a Github actions workflow</h2><p>Github actions are <code>yaml</code> files that live in the <code>.github/workflows</code> folder. Here we have an overview of the actions involved in a workflow and the layout that they occur in.</p><p><img src=/img/gh-action-build-deploy/sections.png alt="Sections of a workflow"></p><p>The core of a Github action workflow is a <code>yaml</code> file. There are hundreds of possible keys that exist to be used in this <code>YAML</code> file. However, today were only going to focus on the few important ones that are required for a basicly setup. We can start with the name for our workflow, it can be anything so don&rsquo;t worry about what you put here.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>name</span>: <span style=color:#ae81ff>Build and Deploy</span>
</code></pre></div><h3 id=trigger>Trigger</h3><p>The trigger is the action that tells your workflow to run. This can be anything from pushing to a branch, cron events, or even webhook events. More on actions can be found <a href=https://help.github.com/en/actions/reference/events-that-trigger-workflows>here</a>. For the sake of this guide, we will be using a <em><strong>push to branch</strong></em> action, in specific we will be triggering our event on a push to the master branch. This is done by using the following 4 lines of code.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>on</span>:
  <span style=color:#f92672>push</span>:
    <span style=color:#f92672>branches</span>:
      - <span style=color:#ae81ff>master</span>
</code></pre></div><p>This reads fairly cleanly so I wont explain it too much, but the root key is the <code>on:</code> key which says the following lines will define our trigger. We then have the <code>push:</code> key which says that the trigger will be an <em><strong>on push</strong></em> trigger. Finally we have the <code>branches:</code> key which lists the branches we want our trigger to listen on. This can be any list of branches. For example, if we want this action to be for a pre-deploy envionment we can trigger on pushes to development branches.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#f92672>on</span>:
  <span style=color:#f92672>push</span>:
    <span style=color:#f92672>branches</span>:
      - <span style=color:#ae81ff>alpha</span>
      - <span style=color:#ae81ff>beta</span>
      - <span style=color:#ae81ff>staging</span>
</code></pre></div><h3 id=runner>Runner</h3><p>The runner is the host OS that our workflow will be running on. Due to the fact that Github Actions use <a href=https://www.docker.com/resources/what-container>docker containers</a> under the covers, we have to specify what we want that container to run.</p><p>At the time of writing this post, there are four available runners. One for Windows, two for Ubuntu Linux, and one for macOS.</p><table><thead><tr><th>Virtual environment</th><th>YAML workflow label</th></tr></thead><tbody><tr><td>Windows Server 2019</td><td><code>windows-latest</code> or <code>windows-2019</code></td></tr><tr><td>Ubuntu 18.04</td><td><code>ubuntu-latest</code> or <code>ubuntu-18.04</code></td></tr><tr><td>Ubuntu 16.04</td><td><code>ubuntu-16.04</code></td></tr><tr><td>macOS Catalina 10.15</td><td><code>macos-latest</code> or <code>macos-10.15</code></td></tr></tbody></table><p>In this guide, we&rsquo;re going to use the <code>ubuntu-16.04</code> (however the process would be the same with any of the Ubuntu runners) image as it&rsquo;ll be the easiest to use for our build process.</p><h3 id=actions>Actions</h3><p>Actions are denoted by the <code>setps:</code> key, which is followed by a list of groups of keys as illustrated in the image at the top of this page. Actions are the bulk of a github actions workflow. They describe the actions that will be executed in the workflow, from checking out the code, to running the actual build process, to deploying. We&rsquo;re going to spend some time learning</p><h4 id=checkout-action>Checkout Action</h4><p>In a build-deploy setup, the checkout action is typically the first step that our workflow will do. The checkout action fetches the most recent version of the repo. This action is provided by github on the &lsquo;actions&rsquo; organization. It is important to note that there are two versions of the checkout action provided by github actions. The key difference is that v1 supports checking out submodules.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>- <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v1</span>
  <span style=color:#f92672>with</span>:
    <span style=color:#f92672>submodules</span>: <span style=color:#66d9ef>true</span>
</code></pre></div><h4 id=third-party-actions>Third Party Actions</h4><p>Other actions can be importated from other people&rsquo;s github repositories. By using the <code>uses:</code> key, you can specify a repo that will be pulled, built, and run during a workflow. These actions can take arguments by using the <code>with:</code> key, which takes a list of key-value pairs similar to envionment variables. For example, deploying a built static page to github pages, we can use <code>JamesIves/github-pages-deploy-action@releases/v3</code> like below:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Deploy</span>
  <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>JamesIves/github-pages-deploy-action@releases/v3</span>
  <span style=color:#f92672>with</span>:
    <span style=color:#f92672>ACCESS_TOKEN</span>: <span style=color:#ae81ff>${{ secrets.ACCESS_TOKEN }}</span>
    <span style=color:#f92672>BRANCH</span>: <span style=color:#ae81ff>gh-pages</span>
    <span style=color:#f92672>FOLDER</span>: <span style=color:#ae81ff>dist</span>
</code></pre></div><p>We name the custom action &ldquo;Deploy&rdquo; and say we will be using the <code>JamesIves/github-pages-deploy-action@releases/v3</code> action. Then by passing 3 arguments of <code>BRANCH</code>, <code>FOLDER</code>, and <code>ACCESS_TOKEN</code>, we can specify the behaviour of the action.</p><h4 id=custom-actions-run>Custom Actions (Run)</h4><p>You can also specify custom bash commands using the <code>run:</code> key.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>- <span style=color:#f92672>run</span>: <span style=color:#ae81ff>npm install</span>
- <span style=color:#f92672>run</span>: <span style=color:#ae81ff>npm run build --if-present</span>
</code></pre></div></div><div class=post-footer><div class=info><span class=separator><a class=tag href=/tags/github/>github</a><a class=tag href=/tags/gh-actions/>gh-actions</a><a class=tag href=/tags/automation/>automation</a><a class=tag href=/tags/devops/>devops</a><a class=tag href=/tags/ci/cd/>ci/cd</a></span></div></div></div></div></div></div><script type=text/javascript src=/js/medium-zoom.min.83cb1dd5fea8d42d87d1e601a07faa73089ad0ef9ccfe5daf6041289ebcc4e46.js integrity="sha256-g8sd1f6o1C2H0eYBoH+qcwia0O+cz+Xa9gQSievMTkY=" crossorigin=anonymous></script></body></html>